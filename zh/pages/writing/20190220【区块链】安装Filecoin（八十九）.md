#20190220ã€åŒºå—é“¾ã€‘å®‰è£…Filecoinï¼ˆå…«åä¹ï¼‰

ä»Šå¤©å‚è€ƒ[å®˜æ–¹Filecoinä¸Šæ‰‹æŒ‡å—](https://github.com/filecoin-project/go-filecoin/wiki/Getting-Started) å®‰è£…è¯•ç©ä¸€ä¸‹Filecoinã€‚æœ¬æƒ³å®‰è£…è¯•ç©ï¼Œç»“æœç¼–è¯‘å¤ªè€—æ—¶é—´ï¼Œåªå®Œæˆäº†å®‰è£…å·¥ä½œã€‚

[TOC]

##å®‰è£…FilecoinåŠç›¸å…³ç¨‹åº

å‚è€ƒ[å®˜æ–¹å®‰è£…æ–‡æ¡£](https://github.com/filecoin-project/go-filecoin/#installation)ï¼Œç›®å‰åªèƒ½ä»æºä»£ç å®‰è£…ï¼Œè€Œä¸”åªæ”¯æŒLinuxå’ŒMacOSï¼ŒWindowså†æ¬¡è¢«æ­§è§†ï¼ˆæˆ‘æ‰‹å¤´è¿™ä¸ªæ—§Macbook Proæ˜¯èƒ½è¯•è¯•çš„ï¼‰ã€‚

å®˜æ–¹æ–‡æ¡£æ˜¯å…ˆæŠŠæºç ä¸‹è½½äº†å†è¯´ï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤ã€‚

```bash
mkdir -p ${GOPATH}/src/github.com/filecoin-project
git clone https://github.com/filecoin-project/go-filecoin.git ${GOPATH}/src/github.com/filecoin-project/go-filecoin
```

ä½†å®é™…ä¸Šï¼Œè¿™æ¡å‘½ä»¤ä¾èµ–äº `${GOPATH}`è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œä»¥åŠGoè¯­è¨€ç¯å¢ƒçš„ç›®å½•ã€‚æ‰€ä»¥ï¼Œæœ€å¥½è¿˜æ˜¯å…ˆæ£€æŸ¥ç›¸å…³çš„ç¨‹åºä¸ç¯å¢ƒæ˜¯å¦å·²ç»OKã€‚

### å®‰è£…Go å’Œ Rust

ç¼–è¯‘go-filecoinéœ€è¦çš„ç¯å¢ƒå¦‚ä¸‹

- [Go](https://golang.org/doc/install)= v1.11.2.

  - ç”¨`go version`æ£€æŸ¥ä¸€ä¸‹ç‰ˆæœ¬

  - ``` bash
    $go version
    go version go1.10.2 darwin/amd64
    ```

  - æˆ‘ä¹‹å‰çš„Goæ˜¯ç”¨Home Brewå®‰è£…çš„ï¼Œç›´æ¥ç”¨`brew upgrade go`æ›´æ–°å°±å¥½äº†

  - ```bash
    $brew upgrade go
    ==> Upgrading 1 outdated package:
    go 1.10.2 -> 1.11.5
    ==> Upgrading go 
    ==> Downloading https://homebrew.bintray.com/bottles/go-1.11.5.mojave.bottle.tar.gz
    ######################################################################## 100.0%
    ==> Pouring go-1.11.5.mojave.bottle.tar.gz
    ğŸº  /usr/local/Cellar/go/1.11.5: 9,298 files, 404.3MB
    
    $go version
    go version go1.11.5 darwin/amd64
    ```

- [Rust](https://www.rust-lang.org/) >= v1.31.0 and `cargo`

  - ç»§ç»­ç”¨Home Brewå¥½äº† `brew install rust`

  - ```bash
    $ brew install rust
    Updating Homebrew...
    ==> Installing dependencies for rust: openssl, libssh2 and pkg-config
    ==> Installing rust dependency: openssl
    ==> Downloading https://homebrew.bintray.com/bottles/openssl-1.0.2q.mojave.bottle.tar.gz
    ######################################################################## 100.0%
    ==> Pouring openssl-1.0.2q.mojave.bottle.tar.gz
    ==> Caveats
    A CA file has been bootstrapped using certificates from the SystemRoots
    keychain. To add additional certificates (e.g. the certificates added in
    the System keychain), place .pem files in
      /usr/local/etc/openssl/certs
    
    and run
      /usr/local/opt/openssl/bin/c_rehash
    
    openssl is keg-only, which means it was not symlinked into /usr/local,
    because Apple has deprecated use of OpenSSL in favor of its own TLS and crypto libraries.
    
    If you need to have openssl first in your PATH run:
      echo 'export PATH="/usr/local/opt/openssl/bin:$PATH"' >> ~/.bash_profile
    
    For compilers to find openssl you may need to set:
      export LDFLAGS="-L/usr/local/opt/openssl/lib"
      export CPPFLAGS="-I/usr/local/opt/openssl/include"
    
    ==> Summary
    ğŸº  /usr/local/Cellar/openssl/1.0.2q: 1,794 files, 12.1MB
    ==> Installing rust dependency: libssh2
    ==> Downloading https://homebrew.bintray.com/bottles/libssh2-1.8.0.mojave.bottle.1.tar.gz
    ######################################################################## 100.0%
    ==> Pouring libssh2-1.8.0.mojave.bottle.1.tar.gz
    ğŸº  /usr/local/Cellar/libssh2/1.8.0: 182 files, 792.8KB
    ==> Installing rust dependency: pkg-config
    ==> Downloading https://homebrew.bintray.com/bottles/pkg-config-0.29.2.mojave.bottle.tar.gz
    ######################################################################## 100.0%
    ==> Pouring pkg-config-0.29.2.mojave.bottle.tar.gz
    ğŸº  /usr/local/Cellar/pkg-config/0.29.2: 11 files, 627.2KB
    ==> Installing rust
    ==> Downloading https://homebrew.bintray.com/bottles/rust-1.32.0.mojave.bottle.1.tar.gz
    ######################################################################## 100.0%
    ==> Pouring rust-1.32.0.mojave.bottle.1.tar.gz
    ğŸº  /usr/local/Cellar/rust/1.32.0: 51,148 files, 852MB
    ==> Caveats
    ==> openssl
    A CA file has been bootstrapped using certificates from the SystemRoots
    keychain. To add additional certificates (e.g. the certificates added in
    the System keychain), place .pem files in
      /usr/local/etc/openssl/certs
    
    and run
      /usr/local/opt/openssl/bin/c_rehash
    
    openssl is keg-only, which means it was not symlinked into /usr/local,
    because Apple has deprecated use of OpenSSL in favor of its own TLS and crypto libraries.
    
    If you need to have openssl first in your PATH run:
      echo 'export PATH="/usr/local/opt/openssl/bin:$PATH"' >> ~/.bash_profile
    
    For compilers to find openssl you may need to set:
      export LDFLAGS="-L/usr/local/opt/openssl/lib"
      export CPPFLAGS="-I/usr/local/opt/openssl/include"
    
    For pkg-config to find openssl you may need to set:
      export PKG_CONFIG_PATH="/usr/local/opt/openssl/lib/pkgconfig"
    ```

  - æ£€æŸ¥ä¸€ä¸‹ç‰ˆæœ¬ `rustc --version`ï¼Œ`cargo --version`

  - ```bash
    $ rustc --version
    rustc 1.32.0
    $ cargo --version
    cargo 1.32.0
    
    ```

- `pkg-config`  go-filecoin ç”¨è¿™ä¸ªæ¥ç”Ÿæˆlink flag

  - Mac OS ä¸Šå¯ä»¥ç”¨brewæ¥å®‰è£… `brew install pkg-config`

- å¦å¤–ï¼ŒFilecoinè¯´è¿˜ç”¨äº†`cgo`ï¼Œå› æ­¤éœ€è¦Cç¼–è¯‘å™¨ï¼Œä»¥å‰åº”è¯¥åœ¨Macä¸Šå®‰è£…è¿‡å¼€å‘è€…å·¥å…·åŒ…ï¼Œç”¨`CC --version` æ£€æŸ¥ä¸€ä¸‹

- ```bash
  $ CC --version
  Apple LLVM version 10.0.0 (clang-1000.10.44.4)
  Target: x86_64-apple-darwin18.2.0
  Thread model: posix
  InstalledDir: /Library/Developer/CommandLineTools/usr/bin
  ```

###ä¿®æ”¹ç¯å¢ƒå˜é‡

ä¿®æ”¹`${GOPATH}` å’Œ `${PATH}`ç¯å¢ƒå˜é‡ï¼Œå’Œæˆ‘ç”µè„‘ä¸ŠGoçš„å®‰è£…ç›®å½•ä¿æŒä¸€è‡´ã€‚åœ¨`~/.bash_profile` ä¸­å¢åŠ  `export GOPATH="/Users/Hooman/go"`  `export PATH="$PATH:$GOPATH/bin"`

```bash
$ go env GOPATH
/Users/Hooman/go
$ . ~/.bash_profile
$ echo ${GOPATH}
/Users/Hooman/go
```

### ä¸‹è½½Filecoinæºç 

```bash
mkdir -p ${GOPATH}/src/github.com/filecoin-project
git clone https://github.com/filecoin-project/go-filecoin.git ${GOPATH}/src/github.com/filecoin-project/go-filecoin
```

### å®‰è£…Go-filecoinä¾èµ–çš„è½¯ä»¶åŒ…

`go-filecoin` ä¾èµ–ä¸€äº›Rustå†™çš„å­æ¨¡å—ä»£ç ï¼Œéœ€è¦ç¡®ä¿`cargo`å·²ç»å®‰è£…å¥½äº†ã€‚

è¿™äº›ä¾èµ–çš„è½¯ä»¶åŒ…ç”¨[gx](https://github.com/whyrusleeping/gx)ç®¡ç†ï¼Œè¿è¡Œä¸‹é¢è¿™ä¸¤æ¡å‘½ä»¤å®‰è£…gx, gometalinterç­‰ç­‰ç¼–è¯‘ã€æµ‹è¯•ç›¸å…³çš„ä¸€å †ä¸œè¥¿ï¼š

```bash
cd ${GOPATH}/src/github.com/filecoin-project/go-filecoin
FILECOIN_USE_PRECOMPILED_RUST_PROOFS=true go run ./build/*.go deps
```

è¿™ä¼šèŠ±ç‚¹æ—¶é—´ï¼Œå¦‚æœå‘ç°è¿™ä¸ªé”™è¯¯

```bash
gx install
panic: exec: "gx": executable file not found in $PATH
```

é‚£ä¹ˆæ˜¯å› ä¸ºæ²¡æœ‰æŠŠ`${GOPATH}/bin` å¢åŠ åˆ° `${PATH}` é‡Œï¼Œç…§ç€ä¸Šé¢æŠŠç¯å¢ƒå˜é‡è®¾ç½®å¥½å†æ¥ä¸€æ¬¡ã€‚

ä¸çŸ¥ä¸ºä½•ï¼Œæˆ‘çš„ç”µè„‘ä¸Šæç¤ºæ²¡æ‰¾åˆ°Rustçš„é¢„ç¼–è¯‘åŒ…ï¼Œç»“æœæ•´ä¸ªé‡æ–°ç¼–è¯‘ï¼Œç”¨äº†ç›¸å½“é•¿æ—¶é—´ï¼ˆè¿œè¿œä¸æ­¢ä¸€æ¯å’–å•¡â˜•ï¸ï¼‰

```bash
using precompiled rust-proofs
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  5685  100  5685    0     0   3146      0  0:00:01  0:00:01 --:--:--  3146
./scripts/install-rust-proofs.sh: line 10: jq: command not found
./scripts/install-rust-proofs.sh: line 18: jq: command not found
curl: (3) <url> malformed
usage: basename string [suffix]
       basename [-a] [-s suffix] string [...]
curl: (3) <url> malformed
asset failed to be downloaded
failed to find or obtain precompiled rust-proofs, falling back to local
```

è¶æ­¤æœºä¼šï¼Œæˆ‘å¤§è‡´æµè§ˆäº†ä¸€ä¸‹Filecoin çš„[ä»£ç ä»‹ç»/Codewalk](https://github.com/filecoin-project/go-filecoin/blob/master/CODEWALK.md)ï¼Œè¿™æ˜¯ä¸€ä¸ªäº†è§£ä»£ç ç»“æ„çš„ç»ä½³å…¥æ‰‹ç‚¹ï¼Œä¸‹é¢è¿™å¼ å›¾å°±æ˜¯æ‘˜è‡ªè¿™é‡Œã€‚

```
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                                     â”‚
  Network  â”‚  network (gossipsub, bitswap, etc.) â”‚                 | | \/
           â”‚                                     â”‚                 |_| /\
           â””â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”˜
                 â”‚            â”‚            â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”     â”‚                            â”‚
           â”‚          â”‚ â”‚           â”‚ â”‚          â”‚     â”‚    Commands / REST API     â”‚
Protocols  â”‚ Storage  â”‚ â”‚  Mining   â”‚ â”‚Retrieval â”‚     â”‚                            â”‚
           â”‚ Protocol â”‚ â”‚ Protocol  â”‚ â”‚ Protocol â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚          â”‚ â”‚           â”‚ â”‚          â”‚                    â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
                 â”‚            â”‚             â”‚                         â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
                            â–¼                           â–¼             â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 Internal  â”‚            Core API            â”‚ â”‚     Porcelain     â”‚     Plumbing    â”‚
      API  â”‚                                â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚                                    â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â–¼              â–¼              â–¼              â–¼              â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚            â”‚ â”‚            â”‚ â”‚            â”‚ â”‚            â”‚ â”‚            â”‚
     Core  â”‚  Message   â”‚ â”‚   Chain    â”‚ â”‚ Processor  â”‚ â”‚   Block    â”‚ â”‚   Wallet   â”‚
           â”‚    Pool    â”‚ â”‚   Store    â”‚ â”‚            â”‚ â”‚  Service   â”‚ â”‚            â”‚
           â”‚            â”‚ â”‚            â”‚ â”‚            â”‚ â”‚            â”‚ â”‚            â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```



æœ€ç»ˆå¦‚æœæ²¡é”™ï¼Œå‘½ä»¤çš„è¾“å‡ºä¼šç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼š

```bash
$ cd ${GOPATH}/src/github.com/filecoin-project/go-filecoin
$ FILECOIN_USE_PRECOMPILED_RUST_PROOFS=true go run ./build/*.go deps
pkg-config --version
0.29.2
Installing dependencies...
go get -u github.com/whyrusleeping/gx
go get -u github.com/whyrusleeping/gx-go
gx install
[get ] [fetch]         QmYxivS34F2M2n44WQQnRHGAKS8aoRUxwGpi9wk4Cdn4Jf go-libp2p
......
......
gx-go rewrite5s
go get -u github.com/alecthomas/gometalinter
gometalinter --install
......
......
go get -u github.com/jstemmer/go-junit-report
go get -u github.com/pmezard/go-difflib/difflib
./scripts/install-rust-proofs.sh
......
......
./scripts/copy-groth-params.sh
/tmp/filecoin-proof-parameters ~/go/src/github.com/filecoin-project/go-filecoin
~/go/src/github.com/filecoin-project/go-filecoin
```



### ç¼–è¯‘ã€æµ‹è¯•ã€å®‰è£…

```bash
# First, build the binary
go run ./build/*.go build

# Install go-filecoin to ${GOPATH}/bin (necessary for tests)
go run ./build/*.go install

# Then, run the tests.
go run ./build/*.go test

# Build and test can be combined!
go run ./build/*.go best
```

ä¸Šé¢è¿™äº›å‘½ä»¤ï¼Œåªéœ€æ‰§è¡Œå‰ä¸‰ä¸ªï¼Œæˆ–è€…æœ€åä¸€ä¸ªä¸‰åˆä¸€ç‰ˆæœ¬çš„å‘½ä»¤ã€‚æ³¨æ„ï¼Œç¬¬ä¸‰ä¸ªå‘½ä»¤æ˜¯æ‰§è¡Œæµ‹è¯•ï¼Œ**æµ‹è¯•çš„æ—¶é—´å…¶å®ä¹ŸæŒºé•¿çš„ã€‚**å¦å¤–ä¸€äº›ç¼–è¯‘æ—¶ç”¨å¾—ä¸Šçš„å‘½ä»¤å¦‚ä¸‹ï¼Œ

```bash
# Check the code for style and correctness issues
go run ./build/*.go lint

# Test with a coverage report
go run ./build/*.go test -cover

# Test with Go's race-condition instrumentation and warnings (see https://blog.golang.org/race-detector)
go run ./build/*.go test -race

# Deps, Lint, Build, Test (any args will be passed to `test`)
go run ./build/*.go all
```

å¦‚æœé‡åˆ°é—®é¢˜å°±å¯ä»¥å»æŸ¥è¯¢ä¸€ä¸‹[Troubleshooting & FAQ](https://github.com/filecoin-project/go-filecoin/wiki/Troubleshooting-&-FAQ) Wiki é¡µé¢ï¼Œæ¯”å¦‚æˆ‘é‡åˆ°çš„**"panic: exec: gx-go executable file is not found in $PATH"**è¿™ä¸ªé”™è¯¯ï¼Œåœ¨è¿™é‡Œå°±æœ‰ç±»ä¼¼è§£å†³æ–¹æ¡ˆã€‚



###æ›´æ–°Filecoinç¨‹åº 

ç¬¬ä¸€æ¬¡å®‰è£…ä¸ç”¨ç®¡è¿™äº›ï¼Œä»¥åæ›´æ–°æ—¶ç”¨ä»¥ä¸‹å‘½ä»¤å°±å¥½ï¼š

```bash
cd $GOPATH/src/github.com/filecoin-project/go-filecoin
git fetch origin devnet-user -f
git checkout devnet-user
FILECOIN_USE_PRECOMPILED_RUST_PROOFS=true go run ./build/*.go deps
go run ./build/*.go build
go run ./build/*.go install
```

## è¿è¡ŒFilecoinç¨‹åº

## ç»™FilecoinèŠ‚ç‚¹å‘½å

## æç‚¹Filecoin

